@page "/{SecretPath:regex(^[a-zA-Z0-9_-]+$)}"
@attribute [Microsoft.AspNetCore.Authorization.AllowAnonymous]
@layout SoftLicence.Server.Components.Layout.EmptyLayout
@inject IConfiguration Config

<PageTitle>Connexion - SoftLicence</PageTitle>

@if (IsPathValid())
{
    <div style="background-color: #121212; color: #e0e0e0; display: flex; align-items: center; justify-content: center; min-height: 100vh; width: 100%; font-family: 'Segoe UI', sans-serif;">
        <div style="background: #1e1e1e; padding: 40px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); border: 1px solid #333; width: 100%; max-width: 400px; margin: 20px;">
            <div style="text-align: center; margin-bottom: 30px; color: #0d6efd;">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-shield-lock-fill" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0c-.69 0-1.843.265-2.928.56-1.11.3-2.229.655-2.887.87a1.54 1.54 0 0 0-1.044 1.262c-.596 4.477.787 7.795 2.465 9.99a11.777 11.777 0 0 0 2.517 2.453c.386.273.744.482 1.048.625.28.132.581.24.829.24s.548-.108.829-.24a7.159 7.159 0 0 0 1.048-.625 11.775 11.775 0 0 0 2.517-2.453c1.678-2.195 3.061-5.513 2.465-9.99a1.541 1.541 0 0 0-1.044-1.263 62.467 62.467 0 0 0-2.887-.87C9.843.266 8.69 0 8 0z" />
                </svg>
                <h1 style="font-size: 1.5rem; margin-top: 10px; color: #fff; border: none !important; outline: none !important;">SoftLicence</h1>
            </div>
            
            <form action="/account/login" method="post">
                <input type="hidden" name="returnUrl" value="@ReturnUrl" />
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #aaa;">Identifiant</label>
                    <input type="text" name="username" style="width: 100%; padding: 10px; background: #2d2d2d; border: 1px solid #444; color: #fff; border-radius: 4px;" required autofocus />
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #aaa;">Mot de passe</label>
                    <input type="password" name="password" style="width: 100%; padding: 10px; background: #2d2d2d; border: 1px solid #444; color: #fff; border-radius: 4px;" required />
                </div>
                @if (!string.IsNullOrEmpty(Error)) {
                    <div style="padding: 10px; background: rgba(220, 53, 69, 0.2); border: 1px solid #dc3545; color: #dc3545; border-radius: 4px; margin-top: 15px; font-size: 0.9rem;">@Error</div>
                }
                <button type="submit" style="width: 100%; padding: 12px; background: #0d6efd; border: none; color: #fff; border-radius: 4px; font-weight: 500; cursor: pointer; margin-top: 20px;">Connexion</button>
            </form>
        </div>
    </div>
}
else
{
    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #121212; color: #6c757d;">
        <div style="text-align: center;">
            <h1 style="font-size: 4rem; font-weight: bold; margin: 0; border: none !important;">404</h1>
            <p>Page inexistante.</p>
        </div>
    </div>
}

@code {
    [Parameter] public string? SecretPath { get; set; }
    [SupplyParameterFromQuery] public string? ReturnUrl { get; set; }
    [SupplyParameterFromQuery] public string? Error { get; set; }

    private bool IsPathValid()
    {
        var configuredSecret = (Config["AdminSettings:LoginPath"] ?? "login")
            .Replace("\"", "").Trim().Trim('/').ToLower();
        
        var currentSecret = (SecretPath ?? "").Trim().Trim('/').ToLower();

        return currentSecret == configuredSecret;
    }
}